<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ランダム画像表示（imagesフォルダ内）</title>
  <style>
    body { text-align: center; padding: 40px; }
    .cards { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
    img { max-width: 300px; max-height: 300px; }
    .info { margin: 15px 0; font-size: 1.2em; }
    .timer { font-size: 1.5em; margin-top: 10px; color: #d9534f; }
    button { padding: 10px 20px; margin-top: 20px; }
    .settings { margin-bottom: 20px; }
    input { width: 60px; text-align: right; }
  </style>
</head>
<body>
  <h1>ランダムカード表示</h1>
  
  <div class="settings">
    表示秒数：<input type="number" id="timeInput" value="2" min="0.1" step="0.1"> 秒
  </div>

  <div class="cards">
    <img id="card1" src="" alt="カード1">
    <img id="card2" src="" alt="カード2">
  </div>

  <div class="info">
    <span id="progress"></span>
    <span id="round"></span>
  </div>

  <div class="timer">
    次のカードまで：<span id="countdown"></span> 秒
  </div>

  <button id="toggleBtn">▶ スタート</button>

  <script>
    const images = [];
    for (let i = 1; i <= 52; i++) {
      images.push(`images/torannpu-illust${i}.png`);
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    let displayTime = 2; // デフォルト秒数（上書きされる）
    let round = 1;
    let shuffledImages = shuffle(images.slice());
    let currentIndex = 0;
    let running = false;
    let lastTimestamp = null;
    let elapsed = 0;
    let startedOnce = false;

    function updateInfo() {
      document.getElementById("progress").textContent = `【${currentIndex + 1} / ${images.length} 枚目】 `;
      document.getElementById("round").textContent = `（${round} 周目）`;
    }

    function showNextTwoCards() {
      if (currentIndex >= shuffledImages.length) {
        round++;
        shuffledImages = shuffle(images.slice());
        currentIndex = 0;
      }

      const card1 = shuffledImages[currentIndex] || "";
      const card2 = shuffledImages[currentIndex + 1] || "";

      document.getElementById("card1").src = card1;
      document.getElementById("card2").src = card2;

      currentIndex += 2;
      elapsed = 0;
      updateInfo();
    }

    function loop(timestamp) {
      if (!running) return;

      if (!lastTimestamp) lastTimestamp = timestamp;
      const delta = (timestamp - lastTimestamp) / 1000;
      lastTimestamp = timestamp;

      elapsed += delta;
      let remaining = displayTime - elapsed;

      if (remaining <= 0) {
        showNextTwoCards();
        remaining = displayTime;
      }

      document.getElementById("countdown").textContent = remaining.toFixed(3);
      requestAnimationFrame(loop);
    }

    function start() {
      if (running) return;

      // スタート時に入力された秒数を取得
      const inputValue = parseFloat(document.getElementById("timeInput").value);
      if (!isNaN(inputValue) && inputValue > 0) {
        displayTime = inputValue;
      } else {
        displayTime = 2; // 無効値なら既定値
      }

      running = true;

      if (!startedOnce) {
        showNextTwoCards();
        startedOnce = true;
      }

      lastTimestamp = null;
      requestAnimationFrame(loop);
      document.getElementById("toggleBtn").textContent = "⏸ 一時停止";
    }

    function pause() {
      running = false;
      lastTimestamp = null;
      document.getElementById("toggleBtn").textContent = "▶ スタート";
    }

    document.getElementById("toggleBtn").addEventListener("click", () => {
      if (running) pause(); else start();
    });

    document.getElementById("countdown").textContent = "0.000";
  </script>
</body>
</html>
